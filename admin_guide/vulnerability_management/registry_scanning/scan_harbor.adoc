:topic_type: task

[.task]
== Scan images on Harbor Registry in Compute Console 

Configure Prisma Cloud to scan your Harbor registry.
To scan a repository in Harbor, create a new registry scan setting.

[.procedure]
. Open Console

. Go to *Defend > Vulnerabilities > Images > Registry Settings*.

. Click *Add Registry*.

. In the dialog, enter the following information:

.. In the *Version* drop-down list, select *Harbor*.

.. In the *Registry* field, enter the FQDN of your Harbor registry (\https://).

.. In *Repository name*, enter the name of the repository to scan, or leave this blank to scan all repositories.

.. In *Credential*, select the credentials to use.
+
If Console doesn't have a copy of your credentials yet, click *Add New*.
Select either *Basic authentication*, and fill out the rest of the fields.
The minimum required credentials for each repository is *Limited Guest*.

.. In *OS type*, specify whether the repo holds *Linux* or *Windows* images.

.. In *Scanner*, select *Automatic*.
+
Console automatically selects an available Defender to execute the scan job.
Alternatively, you can explicitly select a Defender from the drop-down list.
Defenders are listed according to the hosts where they run.
For more information, see xref:../../vulnerability_management/registry_scanning.adoc#_deployment_patterns[deployment patterns].

.. In *Number of scanners*, enter the number of Defenders across which scan jobs can be distributed.

.. Set *Cap* to the number of most recent images to scan.
Leaving *Cap* set to the default value of *5* will scan the most recent 5 images.
Setting this field to *0* will scan all images.

.. Click *Add*.

. Click the yellow save button.
+
image::save_button.png[width=50]
+
// ==== Results
//
// Reusable content fragment.
include::frag_results.adoc[leveloffset=0]

== Integrate Compute as pluggable scanner in Harbor 

Configure Compute as a pluggable scanner to view vulnerability scan results in Harbor Console itself, in addition to Compute Console.
To add Compute as a vulnerability scanner in Harbor, follow steps outlined above for adding Harbor registry in Compute Console. 

[.procedure]
. In Harbor, go to the Administration > Interrogation Services page and click New Scanner. 

. In the pop up, enter details your Compute Console details 

*Name*  
Provide a name for the scanner

*HTTP Endpoint* 
Login to your Compute Console, navigate to Defend > Vulnerabilities > Registry page. 
Under *Harbor scanner adapter* section, copy the URL from field b: "Use the following URL as the Harbor Scanner endpoint".

NOTE: This section only becomes visible after adding Harbor Registry in Compute Console as a registry as per steps outlined in section above. 

*Authorization: None* 

NOTE: Due to a current bug in all Harbor versions other types of authentication methods result in error messages. See https://github.com/goharbor/harbor/issues/12919

. Test Connection and hit Save.

You can now go to Vulnerability tab under Interrogation services and hit Scan Now for vulnerability scanning reports.

Note that when a scan is revoked from Harbor Console using Compute as a vulnerability scanner, Harbor pulls scan from Compute Console. In order to receive faster results, make sure you scan the registry on Compute Console as well. 
